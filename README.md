<div align="center">
  <a href="https://github.com/webpack/webpack">
    <img width="200" height="200" src="https://webpack.js.org/assets/icon-square-big.svg">
  </a>
</div>

# mini-css-extract-optimize-plugin

Eliminate empty js chunks generated by mini-css-extract-plugin when using splitchunks.

## Getting Started

To begin, you'll need to install `mini-css-extract-optimize-plugin`:

```console
$ npm install mini-css-extract-optimize-plugin --save-dev
```

Then, all you need to do is adding the `mini-css-extract-optimize-plugin` to your `webpack` config. 


For example:

**webpack.config.js**

```js
  const miniCSSExtractOptimizePlugin = require('mini-css-extract-optimize-plugin');

  module.exports = {
    plugins: [new miniCSSExtractOptimizePlugin()]
  };
```
## Learn More
> To see how i fix this problem step by step, you can refer to [this](https://gaoyyyang.github.io/2020/07/02/%E6%B7%B1%E5%BA%A6%E5%AE%9E%E8%B7%B5%EF%BC%9A%E6%8F%90%E5%8F%96CSS%E6%97%B6%E7%9A%84%E4%BE%9D%E8%B5%96%E5%9B%BE%E4%BF%AE%E6%AD%A3/) (Written in Chinese).

In `webpack 4` with `mini-css-extract-plugin`, when you use splitchunks to extract css, it will generate empty JS bundle. This empty JS bundle is useless and will cost us one more network connection.

I want to extract all css files in the directory `common/styles`, bundle them into a glabol file `base.css`, so all entries could share it without duplicate css code. The webpack config maybe like:
:
```
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
module.exports = {
  module: {
    rules: [
      {
        // extract css files in directory `common/styles`
        test: /\/common\/styles\/.*css$/ i,
        use: [MiniCssExtractPlugin.loader, 'css-loader'],
      },
    ],
  },
  optimization: {
    splitChunks: {
        cacheGroups: {
            base: {
              name: "base",
              // bundle css files in directory `common/styles` into one single file
              test: /\/common\/styles\/.*(css|scss|sass|less)$/,
              chunks: "all",
              enforce: true
            }
        }
    }
  },
  plugins: [new MiniCssExtractPlugin()],
};
```
It will generate files like:
```
  - base.css
  - base.js
```

Code in `base.css` is the style code we need, but code in `base.js` shows:

```
(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["base"],{

  /***/ "./src/common/styles/base.scss":
  /*!*************************************!*\
    !*** ./src/common/styles/base.scss ***!
    \*************************************/
  /*! no static exports found */
  /***/ (function(module, exports, __webpack_require__) {
  // extracted by mini-css-extract-plugin
  /***/ })
}]);
//# sourceMappingURL=base.af983635.js.map
```
Look, file `base.js` is useless and shouldn't be generated at all !! 

This problem has been [fixed](https://github.com/webpack/webpack/commit/c5f94f3b6a79a88da9ed93b5f980830f496f4fad) in `webpack 5`. But webpack's maintainer don't want to fix it in `webpack 4`.

**Now you can use this plugin to avoid webpack generating that useless empty chunk.**

```
  const miniCSSExtractOptimizePlugin = require('mini-css-extract-optimize-plugin');
  module.exports = {
    // ... other settings
    plugins: [new miniCSSExtractOptimizePlugin()]
  };
```

### To see how i fix this problem step by step, you can refer to [this](https://gaoyyyang.github.io/2020/07/02/%E6%B7%B1%E5%BA%A6%E5%AE%9E%E8%B7%B5%EF%BC%9A%E6%8F%90%E5%8F%96CSS%E6%97%B6%E7%9A%84%E4%BE%9D%E8%B5%96%E5%9B%BE%E4%BF%AE%E6%AD%A3/).


## License

[MIT](./LICENSE)